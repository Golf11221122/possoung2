
function showReceipt(method, paid, change) {
  const orderType = localStorage.getItem("orderType") || "-";
  const customerCount = localStorage.getItem("customerCount") || "-";
  const tableNumber = localStorage.getItem("tableNumber") || "-";
  closeAllPopups();
  let html = `
  <div style="margin-bottom:10px; font-weight:600;">
    üçΩÔ∏è ${orderType} | üë• ${customerCount} ‡∏Ñ‡∏ô | ü™ë ‡πÇ‡∏ï‡πä‡∏∞ ${tableNumber}
  </div>
  <table class="receipt-table">
    <tr>
      <th style="width:60%; text-align:left;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
      <th style="width:20%; text-align:center;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
      <th style="width:20%; text-align:right;">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
    </tr>`;

  let subtotal = 0, totalQty = 0;
  for (const n in order) {
      const it = order[n];
      subtotal += it.price * it.quantity;
      totalQty += it.quantity;
      html += `
      <tr>
        <td>${n}</td>
        <td style="text-align:center;">${it.quantity}</td>
        <td style="text-align:right;">${(it.price * it.quantity).toFixed(2)}</td>
      </tr>`;
  }

  const discount = subtotal * (discountPercent / 100);
  const totalAfterDiscount = subtotal - discount;
  const { beforeVat, vatAmount } = calcTaxFromIncluded(totalAfterDiscount);
  const net = totalAfterDiscount;

  html += `
  <tr>
    <td colspan="3" style="text-align:left; font-weight:bold;">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalQty} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
  </tr>
  </table>

  <div style="display:flex; justify-content:space-between; margin-top:10px;">
    <div style="text-align:left;">
      ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${method}<br>
      ${method === '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' ? `‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏≤: ${paid.toFixed(2)} ‡∏ø<br>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: ${change.toFixed(2)} ‡∏ø<br>` : ''}
      ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleString('th-TH')}
    </div>
    <div style="text-align:right;">
      ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ): ${subtotal.toFixed(2)} ‡∏ø<br>
      ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${discountPercent}%): ${discount.toFixed(2)} ‡∏ø<br>
      ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ: ${beforeVat.toFixed(2)} ‡∏ø<br>
      ‡∏†‡∏≤‡∏©‡∏µ (7%): ${vatAmount.toFixed(2)} ‡∏ø<br>
      <strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ): ${net.toFixed(2)} ‡∏ø</strong>
    </div>
  </div>`;

  document.getElementById('receiptDetails').innerHTML = html;
  showPopup('receiptPopup');
  order = {};
  discountPercent = 0;
  updateSummary();
  updateCartCount();
}
