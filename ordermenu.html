<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--orange:#FFA500;--orange-2:#FFB84D;--blue:#0047AB;--blue-2:#0066CC;--white:#FFFFFF;--glass:rgba(255,255,255,0.9)}
    body{font-family:'Prompt',sans-serif;background:linear-gradient(135deg,var(--orange) 0%,#fff 60%,var(--blue));color:#002366;margin:0;padding:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:transparent;gap:10px}
    .btn-nav{padding:8px 14px;border:none;border-radius:10px;background:var(--glass);color:#002366;font-weight:600;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.06);transition:transform .15s}
    .btn-nav:hover{transform:translateY(-2px)}
    h1{text-align:center;margin:8px 0 12px;font-size:1.5rem;color:#002366}
    .container{display:flex;gap:12px;padding:12px;align-items:flex-start}
    .order-summary{width:320px;background:var(--glass);border-radius:16px;padding:14px;margin-right:8px;min-width:260px;box-shadow:0 8px 24px rgba(0,0,0,0.1);border:1px solid rgba(0,0,0,0.05)}
    .order-summary h3{text-align:center;margin-top:0;color:#002366}
    .order-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:8px}
    .order-item .controls button{font-size:.95rem;width:32px;height:32px;border:none;border-radius:8px;background:var(--orange);color:white;cursor:pointer;font-weight:700;transition:transform .12s}
    .order-item .controls button:hover{transform:scale(1.1);background:var(--orange-2)}
    .summary-total{margin-top:12px;font-weight:700;color:#002366;line-height:1.4;text-align:center}
    .menu-grid{flex:1;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;align-items:start}
    .menu-item{background:#fff;border-radius:14px;text-align:center;box-shadow:0 8px 20px rgba(0,0,0,0.08);padding:12px;cursor:pointer;transition:transform .14s}
    .menu-item:hover{transform:translateY(-6px)}
    .image-placeholder{width:100%;height:110px;background:#eee;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#666;font-size:.95rem;margin-bottom:10px}
    .order-summary button{width:100%;padding:10px;border:none;border-radius:12px;font-weight:700;margin-top:8px;cursor:pointer;font-size:1rem;transition:.2s}
    .order-summary button:first-of-type{background:linear-gradient(90deg,var(--blue),var(--blue-2));color:white}
    .order-summary button:nth-of-type(2){background:linear-gradient(90deg,var(--orange),var(--orange-2));color:#002366}
    .order-summary button:nth-of-type(3){background:linear-gradient(90deg,#FF6347,#FF4500);color:white}
    .order-summary button:nth-of-type(4){background:linear-gradient(90deg,#999,#666);color:white}
    .order-summary button:hover{transform:scale(1.05)}
    .popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:14px;box-shadow:0 20px 50px rgba(0,0,0,0.2);z-index:1000;width:340px;text-align:center;display:none}
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);display:none;z-index:999}
    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .keypad button{padding:14px;font-size:1.2rem;border-radius:10px;border:none;background-color:var(--orange);color:white;font-weight:600;cursor:pointer;transition:transform .12s}
    .keypad button:hover{background-color:var(--orange-2);transform:scale(1.05)}
    .popup input{padding:10px;width:90%;border-radius:8px;border:1px solid rgba(0,0,0,0.08);text-align:center;font-size:1.2rem}
    .payment-buttons{display:flex;justify-content:center;gap:12px;margin-top:10px}
    .payment-buttons button{flex:1;background:linear-gradient(90deg,#FFD27F,#FFB84D)!important;color:#002366!important;font-weight:700!important;border:none!important;border-radius:12px!important;padding:10px 0!important;font-size:1rem!important;cursor:pointer!important;transition:transform .15s ease,background .2s!important;box-shadow:0 3px 10px rgba(0,0,0,0.1)}
    .payment-buttons button:hover{transform:scale(1.05);background:linear-gradient(90deg,#FFC04D,#FFA500)!important}
    #receiptPopup{width:320px!important;max-height:90vh;overflow-y:auto}
    #qrPopup img{width:180px!important;height:auto;margin:0 auto;display:block;border-radius:8px}
    #receiptPopup{background:#fff;border:1px solid #ccc}
    #qrPopup{width:320px;text-align:center;border-radius:16px;background:#fff;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.15)}
    #qrPopup h3{margin-bottom:10px;color:#0047AB}
    #qrPopup img{width:180px;height:auto;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);margin-bottom:10px}
    #qrPopup button{background:linear-gradient(90deg,#4CAF50,#45A049);color:white;font-weight:600;border:none;border-radius:10px;padding:10px 16px;cursor:pointer;transition:transform .2s}
    #qrPopup button:hover{transform:scale(1.05)}
    @media (max-width:768px){.container{flex-direction:column}.order-summary{position:sticky;top:0;width:100%;z-index:1000;margin:0 0 10px 0;border-radius:0 0 16px 16px;box-shadow:0 4px 12px rgba(0,0,0,0.15)}.menu-grid{grid-template-columns:repeat(2,1fr);gap:10px}.menu-item{padding:8px;border-radius:12px;font-size:.9rem}.image-placeholder{height:80px;font-size:.8rem}}
    .cart-button{position:fixed;bottom:18px;right:18px;background:linear-gradient(90deg,#0047AB,#0066CC);color:white;border-radius:50px;padding:12px 18px;font-size:1.1rem;font-weight:700;box-shadow:0 4px 10px rgba(0,0,0,0.3);z-index:1100;cursor:pointer;transition:transform .15s}
    .cart-button:hover{transform:scale(1.05)}
    .cart-button span{background:#FF4500;border-radius:12px;padding:2px 6px;font-size:.9rem;margin-left:4px}
  </style>
</head>

<body>
  <div class="overlay" id="overlay" onclick="closeAllPopups()"></div>
  <header>
    <button class="btn-nav" onclick="goHome()">‚Üê Home</button>
    <button class="btn-nav" onclick="goBack()">‚Üê Back</button>
  </header>

  <h1>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
  <div class="container">
    <div class="order-summary" id="orderSummary" style="display:none;">
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
      <div id="orderItems"></div>
      <div class="summary-total" id="totalSummary"></div>
      <button onclick="closeCart()">‚ûï ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      <button onclick="promptDiscountAuth()">üéÅ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</button>
      <button onclick="payQR()">‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞ QR</button>
      <button onclick="payCash()">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
    </div>

    <div class="menu-grid" id="menuGrid">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...</div>
  </div>

  <div class="popup" id="authPopup">
    <h3>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</h3>
    <input id="pinInput" type="password" maxlength="6" readonly>
    <div class="keypad">
      <button onclick="appendPin('1')">1</button>
      <button onclick="appendPin('2')">2</button>
      <button onclick="appendPin('3')">3</button>
      <button onclick="appendPin('4')">4</button>
      <button onclick="appendPin('5')">5</button>
      <button onclick="appendPin('6')">6</button>
      <button onclick="appendPin('7')">7</button>
      <button onclick="appendPin('8')">8</button>
      <button onclick="appendPin('9')">9</button>
      <button onclick="clearPin()">C</button>
      <button onclick="appendPin('0')">0</button>
      <button onclick="submitPin()">‚úÖ</button>
    </div>
  </div>

  <div class="popup" id="qrPopup">
    <h3>‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
    <img id="qrImage" src="kshop.jpg" alt="QR Code">
    <p>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞: <strong><span id="qrAmount"></span> ‡∏ø</strong></p>
    <button onclick="confirmQR()">‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</button>
  </div>

  <button class="cart-button" id="cartBtn" onclick="openCart()">üõí <span id="cartCount">0</span></button>

  <script type="module">
    const SUPABASE_URL = "https://pujxykbpxsncbrlquaxo.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1anh5a2JweHNuY2JybHF1YXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3OTI0OTIsImV4cCI6MjA3ODM2ODQ5Mn0.JxavkquEZo0W7NME4CJ01GbLKR0_gYFdcKy2BWCrAso";
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    let order = {};

    async function loadMenu() {
      const menuGrid = document.getElementById("menuGrid");
      menuGrid.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
      const { data, error } = await supabase.from("menu").select("*");
      if (error) {
        console.error(error);
        menuGrid.innerHTML = `<p style="color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π</p>`;
        return;
      }
      menuGrid.innerHTML = data.map(item => `
        <div class="menu-item" onclick="addToCart(${item.id}, '${item.name}', ${item.price})">
          <div class="image-placeholder">${item.image ? `<img src="${item.image}" style="width:100%;height:100%;object-fit:cover;border-radius:8px">` : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ"}</div>
          <h4>${item.name}</h4>
          <p>${item.price} ‡∏ø</p>
        </div>
      `).join("");
    }

    window.addToCart = function(id, name, price) {
      if (!order[id]) order[id] = { name, price, qty: 0 };
      order[id].qty++;
      updateCart();
    };

    function updateCart() {
      const total = Object.values(order).reduce((s, i) => s + i.price * i.qty, 0);
      document.getElementById("cartCount").innerText = Object.values(order).reduce((s, i) => s + i.qty, 0);
      document.getElementById("orderItems").innerHTML = Object.entries(order)
        .map(([id, it]) => `<div>${it.name} x${it.qty} = ${it.price * it.qty}‡∏ø</div>`)
        .join("");
      document.getElementById("totalSummary").innerHTML = `<strong>‡∏£‡∏ß‡∏°: ${total} ‡∏ø</strong>`;
    }

    function openCart(){ document.getElementById("orderSummary").style.display = "block"; }
    function closeCart(){ document.getElementById("orderSummary").style.display = "none"; }
    function goHome(){ window.location.href="index.html"; }
    function goBack(){ window.history.back(); }

    loadMenu();
  </script>
</body>
</html>